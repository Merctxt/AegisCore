@inject AegisCoreWeb.AppSettings AppSettings
@{
    ViewData["Title"] = "Documentacao";
    var apiUrl = AppSettings.ApiUrl?.TrimEnd('/') ?? "http://localhost:5050";
}

<div class="container py-5">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-3 mb-4">
            <div class="sticky-top" style="top: 80px;">
                <h6 class="text-muted mb-3">DOCUMENTACAO</h6>
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#intro">Introducao</a>
                    <a class="nav-link" href="#auth">Autenticacao</a>
                    <a class="nav-link" href="#endpoints">Endpoints</a>
                    <a class="nav-link" href="#moderation">Moderacao</a>
                    <a class="nav-link" href="#webhooks">Webhooks</a>
                    <a class="nav-link" href="#errors">Codigos de Erro</a>
                    <a class="nav-link" href="#examples">Exemplos</a>
                </nav>
                <hr>
                <a href="@(apiUrl)/swagger" target="_blank" class="btn btn-primary w-100">
                    <i class="bi bi-code-slash me-2"></i>Abrir Swagger
                </a>
            </div>
        </div>
        
        <!-- Content -->
        <div class="col-lg-9">
            <!-- Intro -->
            <section id="intro" class="mb-5">
                <h1 class="fw-bold">Documentacao da API</h1>
                <p class="lead">
                    A API AegisCore permite analisar textos para detectar conteudo toxico usando 
                    Inteligencia Artificial da Google Perspective API.
                </p>
                
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Base URL:</strong> <code>@apiUrl</code>
                </div>
                
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Para usar a API de moderacao, voce precisa de uma <strong>API Key</strong>. 
                    <a asp-controller="Account" asp-action="Register">Crie uma conta</a> para obter a sua.
                </div>
            </section>
            
            <!-- Auth -->
            <section id="auth" class="mb-5">
                <h2 class="fw-bold border-bottom pb-2">Autenticacao</h2>
                
                <h4 class="mt-4">API Key (para Moderacao)</h4>
                <p>Para endpoints de moderacao, envie sua API Key no header:</p>
                <pre class="bg-dark text-light p-3 rounded"><code>X-Api-Key: aegis_sua_chave_aqui</code></pre>
                
                <h4 class="mt-4">JWT Token (para Dashboard)</h4>
                <p>Para endpoints de gerenciamento, use autenticacao JWT:</p>
                <pre class="bg-dark text-light p-3 rounded"><code>Authorization: Bearer seu_jwt_token</code></pre>
                
                <h5>Obter Token:</h5>
                <pre class="bg-dark text-light p-3 rounded"><code>POST /api/auth/login
Content-Type: application/json

{
  "email": "seu@email.com",
  "password": "suasenha"
}</code></pre>
            </section>
            
            <!-- Endpoints -->
            <section id="endpoints" class="mb-5">
                <h2 class="fw-bold border-bottom pb-2">Endpoints</h2>
                
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Metodo</th>
                                <th>Endpoint</th>
                                <th>Descricao</th>
                                <th>Auth</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-success">POST</span></td>
                                <td><code>/api/auth/register</code></td>
                                <td>Criar conta</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">POST</span></td>
                                <td><code>/api/auth/login</code></td>
                                <td>Login</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">POST</span></td>
                                <td><code>/api/moderation/analyze</code></td>
                                <td>Analisar texto</td>
                                <td>API Key</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">POST</span></td>
                                <td><code>/api/moderation/analyze/batch</code></td>
                                <td>Analise em lote</td>
                                <td>API Key</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">GET</span></td>
                                <td><code>/api/apikeys</code></td>
                                <td>Listar API Keys</td>
                                <td>JWT</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">GET</span></td>
                                <td><code>/api/user/stats</code></td>
                                <td>Estatisticas de uso</td>
                                <td>JWT</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">GET</span></td>
                                <td><code>/api/plans</code></td>
                                <td>Listar planos</td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Moderation -->
            <section id="moderation" class="mb-5">
                <h2 class="fw-bold border-bottom pb-2">Moderacao de Texto</h2>
                
                <h4 class="mt-4">Analisar Texto</h4>
                <pre class="bg-dark text-light p-3 rounded"><code>POST /api/moderation/analyze
X-Api-Key: aegis_sua_chave
Content-Type: application/json

{
  "text": "Texto para analisar",
  "language": "pt",
  "includeAllScores": false,
  "toxicityThreshold": 0.5
}</code></pre>
                
                <h5 class="mt-3">Resposta:</h5>
                <pre class="bg-dark text-light p-3 rounded"><code>{
  "isToxic": false,
  "toxicityScore": 0.12,
  "thresholdUsed": 0.5,
  "allScores": null,
  "analyzedText": "Texto para analisar",
  "timestamp": "2025-01-15T10:30:00Z"
}</code></pre>
                
                <h5 class="mt-3">Parametros:</h5>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Campo</th>
                            <th>Tipo</th>
                            <th>Obrigatorio</th>
                            <th>Descricao</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>text</code></td>
                            <td>string</td>
                            <td>Sim</td>
                            <td>Texto para analise</td>
                        </tr>
                        <tr>
                            <td><code>language</code></td>
                            <td>string</td>
                            <td>Nao</td>
                            <td>Codigo do idioma (pt, en, es). Padrao: pt</td>
                        </tr>
                        <tr>
                            <td><code>includeAllScores</code></td>
                            <td>boolean</td>
                            <td>Nao</td>
                            <td>Incluir scores detalhados</td>
                        </tr>
                        <tr>
                            <td><code>toxicityThreshold</code></td>
                            <td>double</td>
                            <td>Nao</td>
                            <td>Limite para considerar toxico (0.0 a 1.0). Padrao: 0.5</td>
                        </tr>
                    </tbody>
                </table>
                
                <h5 class="mt-3">Scores Detalhados:</h5>
                <p>Quando <code>includeAllScores: true</code>:</p>
                <ul>
                    <li><strong>TOXICITY</strong> - Toxicidade geral</li>
                    <li><strong>SEVERE_TOXICITY</strong> - Toxicidade severa</li>
                    <li><strong>INSULT</strong> - Insultos</li>
                    <li><strong>PROFANITY</strong> - Palavroes</li>
                </ul>
                <p class="text-muted"><small>Nota: IDENTITY_ATTACK e THREAT so estao disponiveis para ingles.</small></p>
            </section>
            
            <!-- Webhooks -->
            <section id="webhooks" class="mb-5">
                <h2 class="fw-bold border-bottom pb-2">Webhooks</h2>
                <p>Receba notificacoes em tempo real quando conteudo toxico for detectado.</p>
                
                <h4 class="mt-4">Criar Webhook</h4>
                <pre class="bg-dark text-light p-3 rounded"><code>POST /api/webhooks
Authorization: Bearer seu_jwt_token
Content-Type: application/json

{
  "name": "Alertas de Toxicidade",
  "url": "https://seu-servidor.com/webhook",
  "secret": "chave_para_validacao",
  "events": 1
}</code></pre>
                
                <h5 class="mt-3">Tipos de Eventos:</h5>
                <ul>
                    <li><code>1</code> - Conteudo Toxico</li>
                    <li><code>2</code> - Alta Toxicidade (&gt;90%)</li>
                    <li><code>4</code> - Rate Limit Atingido</li>
                    <li><code>7</code> - Todos os Eventos</li>
                </ul>
            </section>
            
            <!-- Errors -->
            <section id="errors" class="mb-5">
                <h2 class="fw-bold border-bottom pb-2">Codigos de Erro</h2>
                
                <table class="table">
                    <thead class="table-light">
                        <tr>
                            <th>Codigo</th>
                            <th>Significado</th>
                            <th>Descricao</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>200</code></td>
                            <td>OK</td>
                            <td>Requisicao bem-sucedida</td>
                        </tr>
                        <tr>
                            <td><code>400</code></td>
                            <td>Bad Request</td>
                            <td>Dados invalidos na requisicao</td>
                        </tr>
                        <tr>
                            <td><code>401</code></td>
                            <td>Unauthorized</td>
                            <td>API Key invalida ou nao fornecida</td>
                        </tr>
                        <tr>
                            <td><code>429</code></td>
                            <td>Too Many Requests</td>
                            <td>Limite de requisicoes excedido</td>
                        </tr>
                        <tr>
                            <td><code>500</code></td>
                            <td>Internal Error</td>
                            <td>Erro interno do servidor</td>
                        </tr>
                    </tbody>
                </table>
            </section>
            
            <!-- Examples -->
            <section id="examples" class="mb-5">
                <h2 class="fw-bold border-bottom pb-2">Exemplos de Codigo</h2>
                
                <ul class="nav nav-tabs" id="exampleTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="curl-tab" data-bs-toggle="tab" data-bs-target="#curl" type="button">cURL</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="js-tab" data-bs-toggle="tab" data-bs-target="#js" type="button">JavaScript</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="csharp-tab" data-bs-toggle="tab" data-bs-target="#csharp" type="button">C#</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="python-tab" data-bs-toggle="tab" data-bs-target="#python" type="button">Python</button>
                    </li>
                </ul>
                
                <div class="tab-content mt-3" id="exampleTabsContent">
                    <div class="tab-pane fade show active" id="curl" role="tabpanel">
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST "@(apiUrl)/api/moderation/analyze" \
  -H "Content-Type: application/json" \
  -H "X-Api-Key: aegis_sua_chave" \
  -d '{"text": "Texto para analisar", "language": "pt"}'</code></pre>
                    </div>
                    
                    <div class="tab-pane fade" id="js" role="tabpanel">
                        <pre class="bg-dark text-light p-3 rounded"><code>const response = await fetch('@(apiUrl)/api/moderation/analyze', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-Api-Key': 'aegis_sua_chave'
  },
  body: JSON.stringify({
    text: 'Texto para analisar',
    language: 'pt'
  })
});

const data = await response.json();
console.log(data.isToxic, data.toxicityScore);</code></pre>
                    </div>
                    
                    <div class="tab-pane fade" id="csharp" role="tabpanel">
                        <pre class="bg-dark text-light p-3 rounded"><code>using var client = new HttpClient();
client.DefaultRequestHeaders.Add("X-Api-Key", "aegis_sua_chave");

var response = await client.PostAsJsonAsync(
    "@(apiUrl)/api/moderation/analyze",
    new { text = "Texto para analisar", language = "pt" }
);

var result = await response.Content.ReadFromJsonAsync&lt;ModerationResponse&gt;();
Console.WriteLine($"Toxico: {result.IsToxic}, Score: {result.ToxicityScore}");</code></pre>
                    </div>
                    
                    <div class="tab-pane fade" id="python" role="tabpanel">
                        <pre class="bg-dark text-light p-3 rounded"><code>import requests

response = requests.post(
    '@(apiUrl)/api/moderation/analyze',
    headers={'X-Api-Key': 'aegis_sua_chave'},
    json={'text': 'Texto para analisar', 'language': 'pt'}
)

data = response.json()
print(f"Toxico: {data['isToxic']}, Score: {data['toxicityScore']}")</code></pre>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Smooth scroll for sidebar links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
}

